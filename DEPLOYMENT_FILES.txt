MORSE Render Deployment - File Structure
========================================

Root Directory
â”œâ”€â”€ render.yaml â­
â”‚   â””â”€â”€ Infrastructure-as-code blueprint
â”‚       â€¢ Defines 4 services (frontend, API, DB, Redis)
â”‚       â€¢ Auto-configures environment variables
â”‚       â€¢ Enables health checks and auto-deploy
â”‚
â”œâ”€â”€ init-db.sh â­
â”‚   â””â”€â”€ Database migration script
â”‚       â€¢ Runs before each deploy (preDeployCommand)
â”‚       â€¢ Executes migrations 001 â†’ 006 in order
â”‚       â€¢ Skips test data in production
â”‚
â”œâ”€â”€ validate-render-config.sh â­
â”‚   â””â”€â”€ Pre-deployment validator
â”‚       â€¢ Checks all required files exist
â”‚       â€¢ Verifies migrations are present
â”‚       â€¢ Confirms executable permissions
â”‚
â”œâ”€â”€ .env.example
â”‚   â””â”€â”€ Environment variable template
â”‚       â€¢ Local development reference
â”‚       â€¢ Shows all required variables
â”‚       â€¢ Production variables auto-configured
â”‚
â”œâ”€â”€ QUICK_START.md ğŸ“–
â”‚   â””â”€â”€ 30-second summary + 10-minute deployment
â”‚       â€¢ Fastest way to deploy
â”‚       â€¢ 4 simple steps
â”‚       â€¢ Common first-time issues
â”‚
â”œâ”€â”€ DEPLOYMENT_SUMMARY.md ğŸ“–
â”‚   â””â”€â”€ Executive overview
â”‚       â€¢ What was deleted/simplified
â”‚       â€¢ Cost breakdown ($0 â†’ $21/mo)
â”‚       â€¢ Timeline (10 minutes)
â”‚       â€¢ Scaling guide
â”‚
â”œâ”€â”€ DEPLOYMENT_CHECKLIST.md ğŸ“–
â”‚   â””â”€â”€ Interactive checklist
â”‚       â€¢ Pre-deployment tasks
â”‚       â€¢ Deployment steps
â”‚       â€¢ Post-deployment verification
â”‚       â€¢ Monitoring setup
â”‚
â”œâ”€â”€ RENDER_DEPLOYMENT.md ğŸ“–
â”‚   â””â”€â”€ Comprehensive guide
â”‚       â€¢ Detailed instructions
â”‚       â€¢ Full troubleshooting section
â”‚       â€¢ Cost analysis
â”‚       â€¢ Backup strategies
â”‚       â€¢ 20-minute read
â”‚
â”œâ”€â”€ ARCHITECTURE.md ğŸ“–
â”‚   â””â”€â”€ Technical deep dive
â”‚       â€¢ System diagrams
â”‚       â€¢ Data flow
â”‚       â€¢ Database schema
â”‚       â€¢ Security model
â”‚       â€¢ 30-minute read
â”‚
â””â”€â”€ README_DEPLOYMENT.md ğŸ“–
    â””â”€â”€ Master index
        â€¢ Links to all docs
        â€¢ Quick reference
        â€¢ Support resources

Existing Project Structure (Unchanged)
morse-backend/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ Dockerfile âœ… (used by render.yaml)
â”‚   â”‚   â”œâ”€â”€ package.json âœ…
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â””â”€â”€ app.js (entry point)
â”‚   â”‚
â”‚   â”œâ”€â”€ frontend/
â”‚   â”‚   â”œâ”€â”€ Dockerfile âœ… (used by render.yaml)
â”‚   â”‚   â”œâ”€â”€ package.json âœ…
â”‚   â”‚   â”œâ”€â”€ server.js (Express proxy)
â”‚   â”‚   â””â”€â”€ src/ (React app)
â”‚   â”‚
â”‚   â””â”€â”€ worker/ âŒ (not used in Render deployment)
â”‚
â””â”€â”€ database/
    â””â”€â”€ migrations/ âœ…
        â”œâ”€â”€ 001_initial_schema.sql
        â”œâ”€â”€ 002_workout_tables.sql
        â”œâ”€â”€ 003_workout_sessions.sql
        â”œâ”€â”€ 004_auth_refactor.sql
        â”œâ”€â”€ 005_teams.sql
        â”œâ”€â”€ 005_test_data.sql (skipped in production)
        â””â”€â”€ 006_device_linking_system.sql

Deployment Flow
==============

1. Developer pushes to GitHub
   â””â”€â”€ Triggers Render webhook

2. Render detects render.yaml
   â””â”€â”€ Creates/updates 4 services:
       â”œâ”€â”€ morse-frontend (Web Service)
       â”œâ”€â”€ morse-api (Web Service)
       â”œâ”€â”€ morse-db (PostgreSQL)
       â””â”€â”€ morse-redis (Redis)

3. Database migrations run
   â””â”€â”€ ./init-db.sh executes before deploy
       â””â”€â”€ Runs migrations 001 â†’ 006

4. Docker builds execute in parallel
   â”œâ”€â”€ Frontend: Dockerfile â†’ Build React â†’ Copy to Express server
   â””â”€â”€ Backend: Dockerfile â†’ Install deps â†’ Copy source

5. Health checks verify services
   â”œâ”€â”€ Frontend: GET / â†’ 200 OK
   â””â”€â”€ Backend: GET /health â†’ {"status": "healthy"}

6. Zero-downtime deployment
   â””â”€â”€ Old instances kept alive until new ones are healthy

7. Auto-configured environment variables link services
   â”œâ”€â”€ DATABASE_URL â†’ morse-api
   â”œâ”€â”€ REDIS_* â†’ morse-api
   â””â”€â”€ REACT_APP_API_URL â†’ morse-frontend

8. Services are live!
   â””â”€â”€ https://morse-frontend.onrender.com

Key Design Decisions
===================

âœ… KEPT (Necessary)
- Dockerfiles (containerization)
- Database migrations (schema versioning)
- Health checks (reliability)
- Environment variables (configuration)

âŒ DELETED (Unnecessary)
- Kubernetes YAML (Render handles orchestration)
- Worker service (transcription in API service)
- Custom nginx (Render provides load balancing)
- Manual SSL setup (Render provides free SSL)
- Complex migration tools (simple bash script)

= SIMPLIFIED
- 15+ config files â†’ 1 render.yaml
- Manual env vars â†’ Auto-configured
- Multi-repo setup â†’ Monorepo with paths

Cost Optimization
================

Free Tier (90 days):
  Frontend:     $0  (512MB RAM)
  Backend:      $0  (512MB RAM)
  PostgreSQL:   $0  (1GB, trial)
  Redis:        $0  (25MB, always free)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total:        $0/month

After Trial:
  Frontend:     $7  (Starter)
  Backend:      $7  (Starter)
  PostgreSQL:   $7  (Starter, 10GB)
  Redis:        $0  (Free tier)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total:        $21/month

Scaling path (when needed):
  Starter â†’ Standard â†’ Pro
  $21/mo â†’ $100/mo â†’ $370/mo

Recommendation: Stay on free/starter until 100+ users.

Quick Reference
==============

Deploy Now:
  â†’ Read: QUICK_START.md (2 min)
  â†’ Run: ./validate-render-config.sh
  â†’ Push: git push origin main
  â†’ Deploy: https://dashboard.render.com/blueprints

Troubleshooting:
  â†’ Check: Service logs in Render dashboard
  â†’ Verify: All services show "Live" status
  â†’ Test: Health endpoints
  â†’ Read: RENDER_DEPLOYMENT.md "Troubleshooting" section

Need Help:
  â†’ Docs: RENDER_DEPLOYMENT.md
  â†’ Community: https://community.render.com
  â†’ Status: https://status.render.com

Environment Variables (Manual):
  âš ï¸ GEMINI_API_KEY (required)
     Set in: morse-api â†’ Environment â†’ Add Variable

Everything Else:
  âœ… Auto-configured via render.yaml

Success Criteria
===============

You know it worked when:
  1. All 4 services show green "Live" status
  2. Frontend URL loads MORSE app
  3. Can create user account
  4. Can upload audio file
  5. Transcription completes
  6. Workout data appears in dashboard

If any step fails:
  â†’ Check DEPLOYMENT_CHECKLIST.md
  â†’ Review service logs
  â†’ Verify GEMINI_API_KEY is set
  â†’ Restart failed service

Production Readiness
===================

Ready Now:
  âœ… Dockerized
  âœ… Automated migrations
  âœ… Health checks
  âœ… Zero-downtime deploys
  âœ… HTTPS/SSL
  âœ… Rate limiting
  âœ… Security headers
  âœ… Logging

Need Before Production:
  âš ï¸ Persistent file storage (S3/R2)
  âš ï¸ Error monitoring (Sentry)
  âš ï¸ Analytics (optional)
  âš ï¸ Custom domain (optional)
  âš ï¸ Backup strategy

