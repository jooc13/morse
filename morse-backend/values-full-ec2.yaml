# Full deployment with API, worker, and frontend
api:
  replicaCount: 1
  image:
    repository: morse/api
    tag: "amd64"
  service:
    type: NodePort
    port: 3000
    nodePort: 30080
  resources:
    limits:
      cpu: 300m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

# Enable worker with correct tag
worker:
  replicaCount: 1
  image:
    repository: morse/worker
    tag: "session-grouping"
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi

# Enable frontend with correct tag  
frontend:
  replicaCount: 1
  image:
    repository: morse/frontend
    tag: "amd64-fast"
  service:
    type: NodePort
    port: 3001
    nodePort: 30081
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

# Lightweight PostgreSQL
postgresql:
  enabled: true
  auth:
    postgresPassword: "morse_admin_pass"
    username: "morse_user"
    password: "morse_pass"
    database: "morse_db"
  primary:
    persistence:
      enabled: true
      size: 2Gi
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi
    initdb:
      scripts:
        001_initial_schema.sql: |
          CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
          CREATE TABLE users (
              id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
              device_uuid VARCHAR(255) UNIQUE NOT NULL,
              created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
              last_seen TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
              total_workouts INTEGER DEFAULT 0
          );
          CREATE TABLE audio_files (
              id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
              user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
              original_filename VARCHAR(255) NOT NULL,
              file_path VARCHAR(500) NOT NULL,
              file_size BIGINT NOT NULL,
              duration_seconds DECIMAL(10,2),
              upload_timestamp TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
              processed BOOLEAN DEFAULT FALSE,
              transcription_status VARCHAR(50) DEFAULT 'pending',
              session_id UUID
          );
        003_session_tables.sql: |
          CREATE TABLE IF NOT EXISTS workout_sessions (
              id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
              user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
              session_date DATE NOT NULL,
              session_start_time TIMESTAMP WITH TIME ZONE,
              session_end_time TIMESTAMP WITH TIME ZONE,
              session_duration_minutes INTEGER,
              total_recordings INTEGER DEFAULT 0,
              total_exercises INTEGER DEFAULT 0,
              session_status VARCHAR(50) DEFAULT 'pending',
              notes TEXT,
              created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
              updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
          );
          CREATE TABLE IF NOT EXISTS session_detection_config (
              id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
              user_id UUID REFERENCES users(id) ON DELETE CASCADE,
              session_timeout_minutes INTEGER DEFAULT 60,
              min_session_recordings INTEGER DEFAULT 1,
              auto_complete_sessions BOOLEAN DEFAULT true,
              created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
          );

# Lightweight Redis
redis:
  enabled: true
  auth:
    enabled: false
  master:
    persistence:
      enabled: true
      size: 500Mi
    resources:
      limits:
        cpu: 100m
        memory: 64Mi
      requests:
        cpu: 50m
        memory: 32Mi

# Disable replicas for micro instance
  replica:
    replicaCount: 0

ingress:
  enabled: false

secrets:
  anthropicApiKey: "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"